<script>
  const params = new URLSearchParams(window.location.search);
  const code = params.get('code');

  if (code) {
    // Send to Hasura
    fetch("https://gatewayadventureapp.hasura.app/v1/graphql", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-hasura-admin-secret": "jQIjv3ncSK24JRU2KIwROjd1m2yOxBHu44EMbJiYP31OCzwanMv6GCNUZFvH79Di"
      },
      body: JSON.stringify({
        query: `
          mutation InsertCode($code: String!) {
            insert_google_codes_one(object: {code: $code}) {
              id
            }
          }
        `,
        variables: { code: code }
      })
    }).then(() => {
      document.body.innerHTML = "Login complete! You can return to the app.";
    });
  }
</script>
